(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/common/http'), require('@angular/common')) :
    typeof define === 'function' && define.amd ? define('angular-azure-blob-service', ['exports', '@angular/core', '@angular/common/http', '@angular/common'], factory) :
    (factory((global['angular-azure-blob-service'] = {}),global.ng.core,global.ng.common.http,global.ng.common));
}(this, (function (exports,core,http,common) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var BlobService = /** @class */ (function () {
        function BlobService(http$$1) {
            this.http = http$$1;
        }
        /**
         * @param {?} params
         * @param {?} filename
         * @param {?=} useAzureStorageEmulator
         * @param {?=} azureStorageEmulatorBaseUrl
         * @return {?}
         */
        BlobService.prototype.generateBlobUrl = /**
         * @param {?} params
         * @param {?} filename
         * @param {?=} useAzureStorageEmulator
         * @param {?=} azureStorageEmulatorBaseUrl
         * @return {?}
         */
            function (params, filename, useAzureStorageEmulator, azureStorageEmulatorBaseUrl) {
                if (useAzureStorageEmulator === void 0) {
                    useAzureStorageEmulator = false;
                }
                if (azureStorageEmulatorBaseUrl === void 0) {
                    azureStorageEmulatorBaseUrl = '';
                }
                /** @type {?} */
                var url = useAzureStorageEmulator ? azureStorageEmulatorBaseUrl : "https://" + params.storageAccount + ".blob.core.windows.net";
                return url + "/" + params.containerName + "/" + filename;
            };
        /**
         * @param {?} reader
         * @param {?} state
         * @return {?}
         */
        BlobService.prototype.uploadFileInBlocks = /**
         * @param {?} reader
         * @param {?} state
         * @return {?}
         */
            function (reader, state) {
                if (!state.cancelled) {
                    if (state.totalBytesRemaining > 0) {
                        /** @type {?} */
                        var fileContent = state.file.slice(state.currentFilePointer, state.currentFilePointer + state.maxBlockSize);
                        /** @type {?} */
                        var blockId = state.blockIdPrefix + this.prependZeros(state.blockIds.length, 6);
                        state.blockIds.push(btoa(blockId));
                        reader.readAsArrayBuffer(fileContent);
                        state.currentFilePointer += state.maxBlockSize;
                        state.totalBytesRemaining -= state.maxBlockSize;
                        if (state.totalBytesRemaining < state.maxBlockSize) {
                            state.maxBlockSize = state.totalBytesRemaining;
                        }
                    }
                    else {
                        this.commitBlockList(state);
                    }
                }
            };
        /**
         * @param {?} state
         * @return {?}
         */
        BlobService.prototype.commitBlockList = /**
         * @param {?} state
         * @return {?}
         */
            function (state) {
                /** @type {?} */
                var uri = state.fileUrl + '&comp=blocklist';
                /** @type {?} */
                var headers = new http.HttpHeaders({ 'x-ms-blob-content-type': state.file.type });
                /** @type {?} */
                var requestBody = '<?xml version=\'1.0\' encoding=\'utf-8\'?><BlockList>';
                for (var i = 0; i < state.blockIds.length; i++) {
                    requestBody += '<Latest>' + state.blockIds[i] + '</Latest>';
                }
                requestBody += '</BlockList>';
                this.http.put(uri, requestBody, { headers: headers, responseType: 'text' })
                    .subscribe(function (_elem) {
                    if (state.complete) {
                        state.complete();
                    }
                }, function (err) {
                    console.log({ error: err });
                    if (state.error) {
                        state.error(err);
                    }
                });
            };
        /**
         * @param {?} config
         * @return {?}
         */
        BlobService.prototype.initializeState = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                /** @type {?} */
                var blockSize = BlobService.DefaultBlockSize;
                if (config.blockSize) {
                    blockSize = config.blockSize;
                }
                /** @type {?} */
                var maxBlockSize = blockSize;
                /** @type {?} */
                var numberOfBlocks = 1;
                /** @type {?} */
                var file = config.file;
                /** @type {?} */
                var fileSize = file.size;
                if (fileSize < blockSize) {
                    maxBlockSize = fileSize;
                }
                if (fileSize % maxBlockSize === 0) {
                    numberOfBlocks = fileSize / maxBlockSize;
                }
                else {
                    numberOfBlocks = fileSize / maxBlockSize + 1;
                }
                return {
                    maxBlockSize: maxBlockSize,
                    // Each file will be split in 256 KB.
                    numberOfBlocks: numberOfBlocks,
                    totalBytesRemaining: fileSize,
                    currentFilePointer: 0,
                    blockIds: new Array(),
                    blockIdPrefix: 'block-',
                    bytesUploaded: 0,
                    submitUri: null,
                    file: file,
                    baseUrl: config.baseUrl,
                    sasToken: config.sasToken,
                    fileUrl: config.baseUrl + config.sasToken,
                    progress: config.progress,
                    complete: config.complete,
                    error: config.error,
                    cancelled: false
                };
            };
        /**
         * @param {?} config
         * @return {?}
         */
        BlobService.prototype.upload = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                var _this = this;
                /** @type {?} */
                var state = this.initializeState(config);
                /** @type {?} */
                var reader = new FileReader();
                reader.onloadend = function (evt) {
                    if (evt.target.readyState === 2 && !state.cancelled) {
                        /** @type {?} */
                        var uri = state.fileUrl + '&comp=block&blockid=' + state.blockIds[state.blockIds.length - 1];
                        /** @type {?} */
                        var requestData = evt.target.result;
                        /** @type {?} */
                        var requestData2_1 = new Uint8Array(evt.target.result);
                        /** @type {?} */
                        var headers = new http.HttpHeaders({ 'x-ms-blob-type': 'BlockBlob', 'Content-Type': 'application/octet-stream' });
                        _this.http.put(uri, requestData, { headers: headers, responseType: 'text' })
                            .subscribe(function (_elem) {
                            state.bytesUploaded += requestData2_1.length;
                            /** @type {?} */
                            var percentComplete = Math.round((state.bytesUploaded / state.file.size) * 1000) / 10;
                            if (state.progress) {
                                state.progress(percentComplete);
                            }
                            _this.uploadFileInBlocks(reader, state);
                        }, function (err) {
                            console.log({ error: err });
                            if (state.error) {
                                state.error(err);
                            }
                        });
                    }
                };
                this.uploadFileInBlocks(reader, state);
                return {
                    cancel: function () {
                        state.cancelled = true;
                    }
                };
            };
        /**
         * @param {?} number
         * @param {?} length
         * @return {?}
         */
        BlobService.prototype.prependZeros = /**
         * @param {?} number
         * @param {?} length
         * @return {?}
         */
            function (number, length) {
                /** @type {?} */
                var str = '' + number;
                while (str.length < length) {
                    str = '0' + str;
                }
                return str;
            };
        BlobService.DefaultBlockSize = 1024 * 32;
        BlobService.decorators = [
            { type: core.Injectable }
        ];
        /** @nocollapse */
        BlobService.ctorParameters = function () {
            return [
                { type: http.HttpClient }
            ];
        };
        return BlobService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var BlobModule = /** @class */ (function () {
        function BlobModule() {
        }
        /**
         * @return {?}
         */
        BlobModule.forRoot = /**
         * @return {?}
         */
            function () {
                return {
                    ngModule: BlobModule,
                    providers: [
                        BlobService
                    ]
                };
            };
        BlobModule.decorators = [
            { type: core.NgModule, args: [{
                        imports: [
                            common.CommonModule,
                            http.HttpClientModule
                        ],
                        declarations: [],
                        exports: []
                    },] }
        ];
        return BlobModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    exports.BlobService = BlobService;
    exports.BlobModule = BlobModule;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1henVyZS1ibG9iLXNlcnZpY2UudW1kLmpzLm1hcCIsInNvdXJjZXMiOlsibmc6Ly9hbmd1bGFyLWF6dXJlLWJsb2Itc2VydmljZS9zcmMvYXBwL21vZHVsZXMvYmxvYi9ibG9iLnNlcnZpY2UudHMiLCJuZzovL2FuZ3VsYXItYXp1cmUtYmxvYi1zZXJ2aWNlL3NyYy9hcHAvbW9kdWxlcy9ibG9iL2Jsb2IubW9kdWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJ1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJ1xyXG5pbXBvcnQgeyBVcGxvYWRQYXJhbXMsIFVwbG9hZENvbmZpZyB9IGZyb20gJy4vZGVmaW5pdGlvbnMnXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJsb2JTZXJ2aWNlIHtcclxuICBzdGF0aWMgRGVmYXVsdEJsb2NrU2l6ZSA9IDEwMjQgKiAzMlxyXG4gIGNvbnN0cnVjdG9yIChwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxyXG4gIGdlbmVyYXRlQmxvYlVybCAoXHJcbiAgICBwYXJhbXM6IFVwbG9hZFBhcmFtcyxcclxuICAgIGZpbGVuYW1lOiBzdHJpbmcsXHJcbiAgICB1c2VBenVyZVN0b3JhZ2VFbXVsYXRvciA9IGZhbHNlLFxyXG4gICAgYXp1cmVTdG9yYWdlRW11bGF0b3JCYXNlVXJsID0gJycpIHtcclxuICAgIGNvbnN0IHVybCA9IHVzZUF6dXJlU3RvcmFnZUVtdWxhdG9yID8gYXp1cmVTdG9yYWdlRW11bGF0b3JCYXNlVXJsIDogYGh0dHBzOi8vJHtwYXJhbXMuc3RvcmFnZUFjY291bnR9LmJsb2IuY29yZS53aW5kb3dzLm5ldGBcclxuICAgIHJldHVybiBgJHt1cmx9LyR7cGFyYW1zLmNvbnRhaW5lck5hbWV9LyR7ZmlsZW5hbWV9YFxyXG4gIH1cclxuICBwcml2YXRlIHVwbG9hZEZpbGVJbkJsb2NrcyAocmVhZGVyLCBzdGF0ZSkge1xyXG4gICAgICBpZiAoIXN0YXRlLmNhbmNlbGxlZCkge1xyXG4gICAgICAgICAgaWYgKHN0YXRlLnRvdGFsQnl0ZXNSZW1haW5pbmcgPiAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBzdGF0ZS5maWxlLnNsaWNlKHN0YXRlLmN1cnJlbnRGaWxlUG9pbnRlciwgc3RhdGUuY3VycmVudEZpbGVQb2ludGVyICsgc3RhdGUubWF4QmxvY2tTaXplKVxyXG4gICAgICAgICAgICAgIGNvbnN0IGJsb2NrSWQgPSBzdGF0ZS5ibG9ja0lkUHJlZml4ICsgdGhpcy5wcmVwZW5kWmVyb3Moc3RhdGUuYmxvY2tJZHMubGVuZ3RoLCA2KVxyXG4gICAgICAgICAgICAgIHN0YXRlLmJsb2NrSWRzLnB1c2goYnRvYShibG9ja0lkKSlcclxuICAgICAgICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZUNvbnRlbnQpXHJcbiAgICAgICAgICAgICAgc3RhdGUuY3VycmVudEZpbGVQb2ludGVyICs9IHN0YXRlLm1heEJsb2NrU2l6ZVxyXG4gICAgICAgICAgICAgIHN0YXRlLnRvdGFsQnl0ZXNSZW1haW5pbmcgLT0gc3RhdGUubWF4QmxvY2tTaXplXHJcbiAgICAgICAgICAgICAgaWYgKHN0YXRlLnRvdGFsQnl0ZXNSZW1haW5pbmcgPCBzdGF0ZS5tYXhCbG9ja1NpemUpIHtcclxuICAgICAgICAgICAgICAgICAgc3RhdGUubWF4QmxvY2tTaXplID0gc3RhdGUudG90YWxCeXRlc1JlbWFpbmluZ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5jb21taXRCbG9ja0xpc3Qoc3RhdGUpXHJcbiAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBjb21taXRCbG9ja0xpc3QgKHN0YXRlKSB7XHJcbiAgICAgIGNvbnN0IHVyaSA9IHN0YXRlLmZpbGVVcmwgKyAnJmNvbXA9YmxvY2tsaXN0J1xyXG4gICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHsgJ3gtbXMtYmxvYi1jb250ZW50LXR5cGUnOiBzdGF0ZS5maWxlLnR5cGUgfSlcclxuICAgICAgbGV0IHJlcXVlc3RCb2R5ID0gJzw/eG1sIHZlcnNpb249XFwnMS4wXFwnIGVuY29kaW5nPVxcJ3V0Zi04XFwnPz48QmxvY2tMaXN0PidcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS5ibG9ja0lkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgcmVxdWVzdEJvZHkgKz0gJzxMYXRlc3Q+JyArIHN0YXRlLmJsb2NrSWRzW2ldICsgJzwvTGF0ZXN0PidcclxuICAgICAgfVxyXG4gICAgICByZXF1ZXN0Qm9keSArPSAnPC9CbG9ja0xpc3Q+J1xyXG5cclxuICAgICAgdGhpcy5odHRwLnB1dCh1cmksIHJlcXVlc3RCb2R5LCB7IGhlYWRlcnM6IGhlYWRlcnMsIHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pXHJcbiAgICAgICAgLnN1YnNjcmliZShfZWxlbSA9PiB7XHJcbiAgICAgICAgICBpZiAoc3RhdGUuY29tcGxldGUpIHtcclxuICAgICAgICAgICAgc3RhdGUuY29tcGxldGUoKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyh7IGVycm9yOiBlcnIgfSlcclxuICAgICAgICAgIGlmIChzdGF0ZS5lcnJvcikge1xyXG4gICAgICAgICAgICBzdGF0ZS5lcnJvcihlcnIpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICB9XHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplU3RhdGUgKGNvbmZpZzogVXBsb2FkQ29uZmlnKSB7XHJcbiAgICAgIGxldCBibG9ja1NpemUgPSBCbG9iU2VydmljZS5EZWZhdWx0QmxvY2tTaXplXHJcbiAgICAgIGlmIChjb25maWcuYmxvY2tTaXplKSB7XHJcbiAgICAgICAgYmxvY2tTaXplID0gY29uZmlnLmJsb2NrU2l6ZVxyXG4gICAgICB9XHJcbiAgICAgIGxldCBtYXhCbG9ja1NpemUgPSBibG9ja1NpemVcclxuICAgICAgbGV0IG51bWJlck9mQmxvY2tzID0gMVxyXG4gICAgICBjb25zdCBmaWxlID0gY29uZmlnLmZpbGVcclxuICAgICAgY29uc3QgZmlsZVNpemUgPSBmaWxlLnNpemVcclxuICAgICAgaWYgKGZpbGVTaXplIDwgYmxvY2tTaXplKSB7XHJcbiAgICAgICAgICBtYXhCbG9ja1NpemUgPSBmaWxlU2l6ZVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChmaWxlU2l6ZSAlIG1heEJsb2NrU2l6ZSA9PT0gMCkge1xyXG4gICAgICAgICAgbnVtYmVyT2ZCbG9ja3MgPSBmaWxlU2l6ZSAvIG1heEJsb2NrU2l6ZVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbnVtYmVyT2ZCbG9ja3MgPSBmaWxlU2l6ZSAvIG1heEJsb2NrU2l6ZSArIDFcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIG1heEJsb2NrU2l6ZTogbWF4QmxvY2tTaXplLCAvLyBFYWNoIGZpbGUgd2lsbCBiZSBzcGxpdCBpbiAyNTYgS0IuXHJcbiAgICAgICAgICBudW1iZXJPZkJsb2NrczogbnVtYmVyT2ZCbG9ja3MsXHJcbiAgICAgICAgICB0b3RhbEJ5dGVzUmVtYWluaW5nOiBmaWxlU2l6ZSxcclxuICAgICAgICAgIGN1cnJlbnRGaWxlUG9pbnRlcjogMCxcclxuICAgICAgICAgIGJsb2NrSWRzOiBuZXcgQXJyYXkoKSxcclxuICAgICAgICAgIGJsb2NrSWRQcmVmaXg6ICdibG9jay0nLFxyXG4gICAgICAgICAgYnl0ZXNVcGxvYWRlZDogMCxcclxuICAgICAgICAgIHN1Ym1pdFVyaTogbnVsbCxcclxuICAgICAgICAgIGZpbGU6IGZpbGUsXHJcbiAgICAgICAgICBiYXNlVXJsOiBjb25maWcuYmFzZVVybCxcclxuICAgICAgICAgIHNhc1Rva2VuOiBjb25maWcuc2FzVG9rZW4sXHJcbiAgICAgICAgICBmaWxlVXJsOiBjb25maWcuYmFzZVVybCArIGNvbmZpZy5zYXNUb2tlbixcclxuICAgICAgICAgIHByb2dyZXNzOiBjb25maWcucHJvZ3Jlc3MsXHJcbiAgICAgICAgICBjb21wbGV0ZTogY29uZmlnLmNvbXBsZXRlLFxyXG4gICAgICAgICAgZXJyb3I6IGNvbmZpZy5lcnJvcixcclxuICAgICAgICAgIGNhbmNlbGxlZDogZmFsc2VcclxuICAgICAgfVxyXG4gIH1cclxuICB1cGxvYWQgKGNvbmZpZzogVXBsb2FkQ29uZmlnKSB7XHJcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuaW5pdGlhbGl6ZVN0YXRlKGNvbmZpZylcclxuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcclxuICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoZXZ0OiBhbnkpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQucmVhZHlTdGF0ZSA9PT0gMiAmJiAhc3RhdGUuY2FuY2VsbGVkKSB7XHJcbiAgICAgICAgY29uc3QgdXJpID0gc3RhdGUuZmlsZVVybCArICcmY29tcD1ibG9jayZibG9ja2lkPScgKyBzdGF0ZS5ibG9ja0lkc1tzdGF0ZS5ibG9ja0lkcy5sZW5ndGggLSAxXVxyXG4gICAgICAgIGNvbnN0IHJlcXVlc3REYXRhID0gZXZ0LnRhcmdldC5yZXN1bHRcclxuICAgICAgICBjb25zdCByZXF1ZXN0RGF0YTIgPSBuZXcgVWludDhBcnJheShldnQudGFyZ2V0LnJlc3VsdClcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHsgJ3gtbXMtYmxvYi10eXBlJzogJ0Jsb2NrQmxvYicsICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyB9KVxyXG4gICAgICAgIHRoaXMuaHR0cC5wdXQodXJpLCByZXF1ZXN0RGF0YSwgeyBoZWFkZXJzOiBoZWFkZXJzLCByZXNwb25zZVR5cGU6ICd0ZXh0JyB9KVxyXG4gICAgICAgICAgLnN1YnNjcmliZShfZWxlbSA9PiB7XHJcbiAgICAgICAgICAgIHN0YXRlLmJ5dGVzVXBsb2FkZWQgKz0gcmVxdWVzdERhdGEyLmxlbmd0aFxyXG4gICAgICAgICAgICBjb25zdCBwZXJjZW50Q29tcGxldGUgPSBNYXRoLnJvdW5kKChzdGF0ZS5ieXRlc1VwbG9hZGVkIC8gc3RhdGUuZmlsZS5zaXplKSAqIDEwMDApIC8gMTBcclxuICAgICAgICAgICAgaWYgKHN0YXRlLnByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgICAgc3RhdGUucHJvZ3Jlc3MocGVyY2VudENvbXBsZXRlKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVJbkJsb2NrcyhyZWFkZXIsIHN0YXRlKVxyXG4gICAgICAgICAgfSwgZXJyID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coeyBlcnJvcjogZXJyIH0pXHJcbiAgICAgICAgICAgIGlmIChzdGF0ZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgIHN0YXRlLmVycm9yKGVycilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy51cGxvYWRGaWxlSW5CbG9ja3MocmVhZGVyLCBzdGF0ZSlcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBjYW5jZWw6ICgpID0+IHtcclxuICAgICAgICAgICAgICBzdGF0ZS5jYW5jZWxsZWQgPSB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBwcmVwZW5kWmVyb3MgKG51bWJlciwgbGVuZ3RoKSB7XHJcbiAgICBsZXQgc3RyID0gJycgKyBudW1iZXJcclxuICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuZ3RoKSB7XHJcbiAgICAgIHN0ciA9ICcwJyArIHN0clxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0clxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBOZ01vZHVsZSwgTW9kdWxlV2l0aFByb3ZpZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXHJcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbidcclxuaW1wb3J0IHsgSHR0cENsaWVudE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJ1xyXG5cclxuaW1wb3J0IHsgQmxvYlNlcnZpY2UgfSBmcm9tICcuL2Jsb2Iuc2VydmljZSdcclxuZXhwb3J0IHsgQmxvYlNlcnZpY2UgfSBmcm9tICcuL2Jsb2Iuc2VydmljZSdcclxuZXhwb3J0IHsgVXBsb2FkQ29uZmlnLCBVcGxvYWRQYXJhbXMgfSBmcm9tICcuL2RlZmluaXRpb25zJ1xyXG5cclxuQE5nTW9kdWxlKHtcclxuICBpbXBvcnRzOiBbXHJcbiAgICBDb21tb25Nb2R1bGUsXHJcbiAgICBIdHRwQ2xpZW50TW9kdWxlXHJcbiAgXSxcclxuICBkZWNsYXJhdGlvbnM6IFtdLFxyXG4gIGV4cG9ydHM6IFtdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCbG9iTW9kdWxlIHtcclxuICBzdGF0aWMgZm9yUm9vdCgpOiBNb2R1bGVXaXRoUHJvdmlkZXJzIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5nTW9kdWxlOiBCbG9iTW9kdWxlLFxyXG4gICAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICBCbG9iU2VydmljZVxyXG4gICAgICBdXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJodHRwIiwiSHR0cEhlYWRlcnMiLCJJbmplY3RhYmxlIiwiSHR0cENsaWVudCIsIk5nTW9kdWxlIiwiQ29tbW9uTW9kdWxlIiwiSHR0cENsaWVudE1vZHVsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO1FBTUUscUJBQXFCQSxPQUFnQjtZQUFoQixTQUFJLEdBQUpBLE9BQUksQ0FBWTtTQUFLOzs7Ozs7OztRQUMxQyxxQ0FBZTs7Ozs7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