{"version":3,"file":"ref.js","sourceRoot":"","sources":["../../../src/storage/ref.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,gBAAgB,EAAyB,MAAM,QAAQ,CAAC;AACjE,OAAO,EAAc,IAAI,EAAE,MAAM,MAAM,CAAC;AAkBxC,MAAM,UAAU,gBAAgB,CAAC,GAAc,EAAE,SAAgC;IAC/E,OAAO;QACL,cAAc,EAAE,cAAM,OAAA,SAAS,CAAC,sBAAsB,CACpD,SAAS,CAAC,iBAAiB,CACzB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAM,OAAA,GAAG,CAAC,cAAc,EAAE,EAApB,CAAoB,CAAC,CAAC,CACnE,CACF,EAJqB,CAIrB;QACD,WAAW,EAAE,cAAM,OAAA,SAAS,CAAC,sBAAsB,CACjD,SAAS,CAAC,iBAAiB,CACzB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAM,OAAA,GAAG,CAAC,WAAW,EAAE,EAAjB,CAAiB,CAAC,CAAC,CAChE,CACF,EAJkB,CAIlB;QACD,MAAM,EAAE,cAAM,OAAA,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAlB,CAAkB;QAChC,KAAK,EAAE,UAAC,IAAY,IAAK,OAAA,gBAAgB,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC,EAA5C,CAA4C;QACrE,eAAe,EAAE,UAAC,IAAsB,IAAK,OAAA,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAA9B,CAA8B;QAC3E,GAAG,EAAE,UAAC,IAAS,EAAE,QAAyB;YACxC,IAAM,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;YACrC,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;QACD,SAAS,EAAE,UAAC,IAAY,EAAE,MAAqB,EAAE,QAAyB;YACxE,IAAM,IAAI,GAAG,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACnD,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;KACF,CAAC;AACJ,CAAC","sourcesContent":["import { SettableMetadata, UploadMetadata, Reference, StringFormat } from './interfaces';\nimport { createUploadTask, AngularFireUploadTask } from './task';\nimport { Observable, from } from 'rxjs';\nimport { FirebaseZoneScheduler } from '@angular/fire';\n\nexport interface AngularFireStorageReference {\n  getDownloadURL(): Observable<any>;\n  getMetadata(): Observable<any>;\n  delete(): Observable<any>;\n  child(path: string): any;\n  updateMetatdata(meta: SettableMetadata): Observable<any>;\n  put(data: any, metadata?: UploadMetadata | undefined): AngularFireUploadTask;\n  putString(data: string, format?: string | undefined, metadata?: UploadMetadata | undefined): AngularFireUploadTask;\n}\n\n/**\n * Create an AngularFire wrapped Storage Reference. This object\n * creates observable methods from promise based methods.\n * @param ref\n */\nexport function createStorageRef(ref: Reference, scheduler: FirebaseZoneScheduler): AngularFireStorageReference {\n  return {\n    getDownloadURL: () => scheduler.keepUnstableUntilFirst(\n      scheduler.runOutsideAngular(\n        from(scheduler.zone.runOutsideAngular(() => ref.getDownloadURL()))\n      )\n    ),\n    getMetadata: () => scheduler.keepUnstableUntilFirst(\n      scheduler.runOutsideAngular(\n        from(scheduler.zone.runOutsideAngular(() => ref.getMetadata()))\n      )\n    ),\n    delete: () => from(ref.delete()),\n    child: (path: string) => createStorageRef(ref.child(path), scheduler),\n    updateMetatdata: (meta: SettableMetadata) => from(ref.updateMetadata(meta)),\n    put: (data: any, metadata?: UploadMetadata) => {\n      const task = ref.put(data, metadata);\n      return createUploadTask(task);\n    },\n    putString: (data: string, format?: StringFormat, metadata?: UploadMetadata) => {\n      const task = ref.putString(data, format, metadata);\n      return createUploadTask(task);\n    }\n  };\n}\n"]}