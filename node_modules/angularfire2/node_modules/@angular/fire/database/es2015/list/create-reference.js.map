{"version":3,"file":"create-reference.js","sourceRoot":"","sources":["../../../../../src/database/list/create-reference.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AACrD,OAAO,EAAE,YAAY,EAAE,MAAM,iBAAiB,CAAC;AAC/C,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EAAE,yBAAyB,EAAE,MAAM,kBAAkB,CAAC;AAC7D,OAAO,EAAE,kBAAkB,EAAE,MAAM,UAAU,CAAC;AAE9C,OAAO,EAAE,GAAG,EAAE,MAAM,gBAAgB,CAAC;AAErC,MAAM,UAAU,mBAAmB,CAAQ,KAAoB,EAAE,UAA+B;IAC9F,OAAO;QACL,KAAK;QACL,MAAM,EAAE,yBAAyB,CAAa,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC;QAClE,GAAG,EAAE,yBAAyB,CAAI,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC;QACnD,IAAI,EAAE,CAAC,IAAO,EAAE,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;QACvC,MAAM,EAAE,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC;QACrC,eAAe,CAAC,MAAqB;YACnC,MAAM,gBAAgB,GAAG,eAAe,CAAI,KAAK,EAAE,MAAM,CAAC,CAAC;YAC3D,OAAO,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,gBAAgB,CACjB,CACF,CAAC;QACJ,CAAC;QACD,YAAY,CAAC,MAAqB;YAChC,MAAM,aAAa,GAAG,YAAY,CAAI,KAAK,EAAE,MAAM,CAAC,CAAC;YACrD,OAAO,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,aAAa,CACd,CACF,CAAC;QACJ,CAAC;QACD,UAAU,CAAC,MAAqB;YAC9B,MAAM,WAAW,GAAG,UAAU,CAAI,KAAK,EAAE,MAAM,CAAC,CAAA;YAChD,OAAO,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,WAAW,CACZ,CACF,CAAC;QACJ,CAAC;QACD,YAAY,CAAC,MAAqB;YAChC,MAAM,gBAAgB,GAAG,eAAe,CAAI,KAAK,EAAE,MAAM,CAAC,CAAC;YAC3D,OAAO,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,gBAAgB,CACjB,CACF,CAAC,IAAI,CACJ,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAO,CAAC,CAAC,CACvD,CAAC;QACJ,CAAC;KACF,CAAA;AACH,CAAC","sourcesContent":["import { DatabaseQuery, AngularFireList, ChildEvent } from '../interfaces';\nimport { snapshotChanges } from './snapshot-changes';\nimport { stateChanges } from './state-changes';\nimport { auditTrail } from './audit-trail';\nimport { createDataOperationMethod } from './data-operation';\nimport { createRemoveMethod } from './remove';\nimport { AngularFireDatabase } from '../database';\nimport { map } from 'rxjs/operators';\n\nexport function createListReference<T=any>(query: DatabaseQuery, afDatabase: AngularFireDatabase): AngularFireList<T> {\n  return {\n    query,\n    update: createDataOperationMethod<Partial<T>>(query.ref, 'update'),\n    set: createDataOperationMethod<T>(query.ref, 'set'),\n    push: (data: T) => query.ref.push(data),\n    remove: createRemoveMethod(query.ref),\n    snapshotChanges(events?: ChildEvent[]) {\n      const snapshotChanges$ = snapshotChanges<T>(query, events);\n      return afDatabase.scheduler.keepUnstableUntilFirst(\n        afDatabase.scheduler.runOutsideAngular(\n          snapshotChanges$\n        )\n      );\n    },\n    stateChanges(events?: ChildEvent[]) {\n      const stateChanges$ = stateChanges<T>(query, events);\n      return afDatabase.scheduler.keepUnstableUntilFirst(\n        afDatabase.scheduler.runOutsideAngular(\n          stateChanges$\n        )\n      );\n    },\n    auditTrail(events?: ChildEvent[]) {\n      const auditTrail$ = auditTrail<T>(query, events)\n      return afDatabase.scheduler.keepUnstableUntilFirst(\n        afDatabase.scheduler.runOutsideAngular(\n          auditTrail$\n        )\n      );\n    },\n    valueChanges(events?: ChildEvent[]) {\n      const snapshotChanges$ = snapshotChanges<T>(query, events);\n      return afDatabase.scheduler.keepUnstableUntilFirst(\n        afDatabase.scheduler.runOutsideAngular(\n          snapshotChanges$\n        )\n      ).pipe(\n        map(actions => actions.map(a => a.payload.val() as T))\n      );\n    }\n  }\n}\n"]}